<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tugas Akhir PW: Judul 5</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

    <style>
        body {
            background-color: #e2e8f0;
            font-family: 'Segoe UI', sans-serif;
        }

        .calculator-body {
            background-color: #4a5568;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
            border-bottom: 8px solid #2d3748;
        }

        /* Display Calculator */
        .display-container {
            background-color: #aed581;
            border: 4px solid #333;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 20px;
            box-shadow: inset 0 3px 6px rgba(0, 0, 0, 0.2);
        }

        .calc-display {
            background-color: transparent;
            color: #1a1a1a;
            font-family: 'Courier New', Courier, monospace;
            font-size: 2.2rem;
            font-weight: bold;
            border: none;
            box-shadow: none;
        }

        .calc-display:focus {
            background-color: transparent;
            box-shadow: none;
        }

        #history-preview {
            color: #444;
            font-family: monospace;
            font-size: 0.9rem;
            height: 20px;
            display: block;
            text-align: right;
        }

        /* Styling Tombol */
        .btn-calc {
            height: 60px;
            font-size: 1.25rem;
            font-weight: bold;
            border-radius: 10px;
            border: none;
            box-shadow: 0 4px 0 rgba(0, 0, 0, 0.3);
            transition: all 0.1s;
            margin-bottom: 10px;
        }

        .btn-calc:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        /* Warna-warna tombol custom */
        .btn-num {
            background-color: #2d3436;
            color: white;
        }

        .btn-num:hover {
            background-color: #444;
            color: white;
        }

        .btn-op {
            background-color: #636e72;
            color: white;
        }

        .btn-op:hover {
            background-color: #7f8c8d;
            color: white;
        }

        .btn-action {
            background-color: #b2bec3;
            color: #2d3436;
            font-size: 0.9rem;
            height: 45px;
        }

        .btn-action:hover {
            background-color: #dfe6e9;
        }

        .btn-danger-custom {
            background-color: #ff7675;
            color: white;
        }

        .btn-danger-custom:hover {
            background-color: #d63031;
            color: white;
        }

        .btn-equal {
            background-color: #e67e22;
            color: white;
        }

        .btn-equal:hover {
            background-color: #d35400;
            color: white;
        }

        .history-card {
            border: none;
            border-radius: 15px;
            overflow: hidden;
        }

        .history-header {
            background-color: #2d3436;
            color: white;
        }
    </style>
</head>

<body>

    <div class="container py-5">
        <div class="row justify-content-center">

            <div class="col-md-6 col-lg-5 mb-4">
                <div class="calculator-body">
                    <div class="text-white mb-2 ms-1"
                        style="font-family: sans-serif; font-style: italic; opacity: 0.7;">
                        CASIO <span style="font-size: 0.7rem;">JS-5</span>
                    </div>

                    <div class="display-container">
                        <small id="history-preview"></small>
                        <input type="text" id="display" class="form-control calc-display text-end" value="0" readonly>
                    </div>

                    <div class="row g-2 mb-2">
                        <div class="col-3"><button class="btn btn-calc btn-action w-100"
                                onclick="memoryFunc('MC')">MC</button></div>
                        <div class="col-3"><button class="btn btn-calc btn-action w-100"
                                onclick="memoryFunc('MR')">MR</button></div>
                        <div class="col-3"><button class="btn btn-calc btn-action w-100"
                                onclick="memoryFunc('M-')">M-</button></div>
                        <div class="col-3"><button class="btn btn-calc btn-action w-100"
                                onclick="memoryFunc('M+')">M+</button></div>
                    </div>

                    <div class="row g-2">
                        <div class="col-3"><button class="btn btn-calc btn-danger-custom w-100"
                                onclick="clearDisplay('CE')">CE</button></div>
                        <div class="col-3"><button class="btn btn-calc btn-danger-custom w-100"
                                onclick="clearDisplay('C')">C</button></div>
                        <div class="col-3"><button class="btn btn-calc btn-op w-100"
                                onclick="inputOperator('/')">÷</button></div>
                        <div class="col-3"><button class="btn btn-calc btn-op w-100"
                                onclick="inputOperator('*')">×</button></div>
                    </div>

                    <div class="row g-2">
                        <div class="col-3"><button class="btn btn-calc btn-num w-100"
                                onclick="inputNumber('7')">7</button></div>
                        <div class="col-3"><button class="btn btn-calc btn-num w-100"
                                onclick="inputNumber('8')">8</button></div>
                        <div class="col-3"><button class="btn btn-calc btn-num w-100"
                                onclick="inputNumber('9')">9</button></div>
                        <div class="col-3"><button class="btn btn-calc btn-op w-100"
                                onclick="inputOperator('-')">-</button></div>
                    </div>

                    <div class="row g-2">
                        <div class="col-3"><button class="btn btn-calc btn-num w-100"
                                onclick="inputNumber('4')">4</button></div>
                        <div class="col-3"><button class="btn btn-calc btn-num w-100"
                                onclick="inputNumber('5')">5</button></div>
                        <div class="col-3"><button class="btn btn-calc btn-num w-100"
                                onclick="inputNumber('6')">6</button></div>
                        <div class="col-3"><button class="btn btn-calc btn-op w-100"
                                onclick="inputOperator('+')">+</button></div>
                    </div>

                    <div class="row g-2">
                        <div class="col-9">
                            <div class="row g-2">
                                <div class="col-4"><button class="btn btn-calc btn-num w-100"
                                        onclick="inputNumber('1')">1</button></div>
                                <div class="col-4"><button class="btn btn-calc btn-num w-100"
                                        onclick="inputNumber('2')">2</button></div>
                                <div class="col-4"><button class="btn btn-calc btn-num w-100"
                                        onclick="inputNumber('3')">3</button></div>
                                <div class="col-8"><button class="btn btn-calc btn-num w-100"
                                        onclick="inputNumber('0')">0</button></div>
                                <div class="col-4"><button class="btn btn-calc btn-num w-100"
                                        onclick="inputDecimal()">.</button></div>
                            </div>
                        </div>
                        <div class="col-3">
                            <button class="btn btn-calc btn-equal w-100" style="height: 130px;"
                                onclick="hitungHasil()">=</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6 col-lg-4">
                <div class="alert alert-secondary d-flex justify-content-between align-items-center shadow-sm border-0">
                    <span><i class="bi bi-memory"></i> Memory:</span>
                    <span id="mem-status" class="badge bg-dark fs-6">0</span>
                </div>

                <div class="card shadow history-card">
                    <div class="card-header history-header py-3">
                        <h5 class="mb-0"><i class="bi bi-clock-history"></i> Riwayat</h5>
                    </div>
                    <ul class="list-group list-group-flush" id="historyList">
                        <li class="list-group-item text-center text-muted py-4">Belum ada perhitungan</li>
                    </ul>
                </div>

                <div class="mt-3 text-center">
                    <small class="text-muted fst-italic">Keyboard Support Enabled</small>
                </div>
            </div>

        </div>
    </div>

    <script>
        // Variabel untuk menyimpan state kalkulator
        let currentInput = '0';
        let memoryValue = 0;
        let historyData = [];

        const display = document.getElementById('display');
        const historyList = document.getElementById('historyList');
        const memStatus = document.getElementById('mem-status');
        const preview = document.getElementById('history-preview');

        // Fungsi input angka
        function inputNumber(num) {
            if (currentInput === '0') {
                currentInput = num;
            } else {
                currentInput += num;
            }
            updateDisplay();
        }

        // Fungsi input operator aritmatika
        function inputOperator(operator) {
            const lastChar = currentInput.slice(-1);
            if (['+', '-', '*', '/'].includes(lastChar)) {
                currentInput = currentInput.slice(0, -1) + operator;
            } else {
                currentInput += operator;
            }
            updateDisplay();
        }

        // Fungsi input titik desimal
        function inputDecimal() {
            const parts = currentInput.split(/[\+\-\*\/]/);
            const lastPart = parts[parts.length - 1];

            // Cek jika sudah ada titik di angka terakhir
            if (!lastPart.includes('.')) {
                currentInput += '.';
            }
            updateDisplay();
        }

        // Fungsi Reset (C) dan Hapus satu karakter (CE)
        function clearDisplay(type) {
            if (type === 'C') {
                currentInput = '0';
                preview.innerText = '';
            } else if (type === 'CE') {
                currentInput = currentInput.toString().slice(0, -1);
                if (currentInput === '') currentInput = '0';
            }
            updateDisplay();
        }

        // Logika utama perhitungan hasil
        function hitungHasil() {
            try {

                let hasil = eval(currentInput);

                if (!isFinite(hasil) || isNaN(hasil)) {
                    throw new Error("Tidak bisa bagi nol!");
                }

                if (!Number.isInteger(hasil)) {
                    hasil = parseFloat(hasil.toFixed(8));
                }

                // Tambahkan ke history
                const expression = currentInput + " = " + hasil;
                addHistory(expression);

                currentInput = hasil.toString();
                updateDisplay();
                preview.innerText = '';

            } catch (error) {
                alert("Error: " + error.message);
                currentInput = '0';
                updateDisplay();
            }
        }

        // Update tampilan input
        function updateDisplay() {
            let visual = currentInput.replace(/\*/g, '×').replace(/\//g, '÷');
            display.value = visual;
        }

        // Fungsi tombol Memory (M+, M-, MR, MC)
        function memoryFunc(action) {
            let val = 0;
            try { val = parseFloat(eval(currentInput)) || 0; } catch (e) { }

            if (action === 'M+') memoryValue += val;
            else if (action === 'M-') memoryValue -= val;
            else if (action === 'MC') memoryValue = 0;
            else if (action === 'MR') {
                currentInput = memoryValue.toString();
                updateDisplay();
            }
            memStatus.innerText = memoryValue;
        }

        // Fungsi manajemen History (Max 5 item)
        function addHistory(entry) {
            historyData.push(entry);
            if (historyData.length > 5) historyData.shift();
            renderHistory();
        }

        function renderHistory() {
            historyList.innerHTML = "";
            historyData.slice().reverse().forEach(item => {
                let li = document.createElement("li");
                li.className = "list-group-item d-flex justify-content-between align-items-center";
                li.innerText = item;


                if (item === historyData[historyData.length - 1]) {
                    li.innerHTML += ' <span class="badge bg-warning text-dark rounded-pill" style="font-size:0.7rem">Baru</span>';
                }
                historyList.appendChild(li);
            });
        }

        // Event listener untuk Keyboard
        document.addEventListener('keydown', function (event) {
            const key = event.key;
            if (key >= '0' && key <= '9') inputNumber(key);
            else if (key === '+') inputOperator('+');
            else if (key === '-') inputOperator('-');
            else if (key === '*') inputOperator('*');
            else if (key === '/') inputOperator('/');
            else if (key === 'Enter' || key === '=') {
                event.preventDefault();
                hitungHasil();
            }
            else if (key === 'Backspace') clearDisplay('CE');
            else if (key === 'Escape') clearDisplay('C');
            else if (key === '.' || key === ',') inputDecimal();
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>